#pragma once

#include "CoreMinimal.h"

#include "RTSActorComponent.h"

#include "Templates/SubclassOf.h"

#include "Economy/RTSResourceType.h"

#include "RTSResourceDrainComponent.generated.h"


DECLARE_DYNAMIC_MULTICAST_DELEGATE_FourParams(FRTSResourceDrainComponentResourcesReturnedSignature, AActor*, ResourceDrain, AActor*, Gatherer, TSubclassOf<URTSResourceType>, ResourceType, float, ResourceAmount);


/**
* Allows resources to be returned to the actor.
*/
UCLASS(meta = (BlueprintSpawnableComponent))
class REALTIMESTRATEGY_API URTSResourceDrainComponent : public URTSActorComponent
{
	GENERATED_BODY()

public:
	URTSResourceDrainComponent(const FObjectInitializer& ObjectInitializer = FObjectInitializer::Get());


	/** Returns resources to this actor, notifying the owning player. */
	virtual float ReturnResources(AActor* Gatherer, TSubclassOf<URTSResourceType> ResourceType, float ResourceAmount);

    
    /** Gets the types of resources that can be returned to the actor. */
    UFUNCTION(BlueprintPure)
    TArray<TSubclassOf<URTSResourceType>> GetResourceTypes() const;

    /** Whether gatherers must enter the resource drain for returning resources. */
    UFUNCTION(BlueprintPure)
    bool MustGathererEnter() const;

    /** Gets how many gatherers may enter at the same time. */
    UFUNCTION(BlueprintPure)
    int32 GetGathererCapacity() const;


    /** Event when resources have been returned to the actor. */
    UFUNCTION(NetMulticast, reliable)
    virtual void NotifyOnResourcesReturned(AActor* Gatherer, TSubclassOf<URTSResourceType> ResourceType, float ResourceAmount);


	/** Event when resources have been returned to the actor. */
	UPROPERTY(BlueprintAssignable, Category = "RTS")
	FRTSResourceDrainComponentResourcesReturnedSignature OnResourcesReturned;

private:
    /** Types of resources that can be returned to the actor. */
    UPROPERTY(EditDefaultsOnly, Category = "RTS")
    TArray<TSubclassOf<URTSResourceType>> ResourceTypes;

    /** Whether gatherers must enter the resource drain for returning resources. */
    UPROPERTY(EditDefaultsOnly, Category = "RTS")
    bool bGathererMustEnter;

    /** How many gatherers may enter at the same time. */
    UPROPERTY(EditDefaultsOnly, Category = "RTS", meta = (ClampMin = 1))
    int32 GathererCapacity;
};
